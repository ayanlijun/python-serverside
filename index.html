<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Python Serverside</title>

  
  <link rel="icon" type="image/png" href="/favicon.png"/>
  

  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">
  <link href="/python-serverside/assets/css/docs.min.css" rel="stylesheet">
  <link href="/python-serverside/assets/css/style.css" rel="stylesheet">
  <link href="/python-serverside/assets/css/prism.css" rel="stylesheet">

  <script src="/python-serverside/assets/js/prism.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.3.0/bootbox.min.js"></script>
  <script src="/python-serverside/assets/js/docs.min.js"></script>
  <script src="/python-serverside/assets/js/script.js"></script>
</head>

<body>
  <!-- Main navigation
  =========================================== -->
  <header class="navbar navbar-static-top bs-docs-nav" id="top">
    <div class="container">
      <div class="navbar-header" role="banner">
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/index.html">Python Serverside</a>
      </div>
      <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
        <ul class="nav navbar-nav">
        
          
          
            
            <li >
              <a href="/python-serverside/changelog.html">Changelog</a>
            </li>
            
          
            
          
            
          
        
        </ul>
        <ul class="nav navbar-nav navbar-right">
          
          <li>
            <a href="https://github.com/asciialex/python-serverside">GitHub</a>
          </li>
          
        </ul>
      </nav>
    </div>
  </header>


  <!-- Header
  =========================================== -->
  
  <div class="bs-docs-masthead" id="content">
    <div class="container">
      <h1 class="home-title">Python Serverside</h1>
      <p class="lead">Python Serverside Toolkit</p>
      <p class="version">Currently v1.0.2</p>
      
        <iframe class="github-btn" src="https://ghbtns.com/github-btn.html?user=asciialex&amp;repo=python-serverside&amp;type=watch&amp;count=true" width="90" height="20" title="Star on GitHub"></iframe>
        <iframe class="github-btn" src="https://ghbtns.com/github-btn.html?user=asciialex&amp;repo=python-serverside&amp;type=fork&amp;count=true" width="90" height="20" title="Fork on GitHub"></iframe>
    
    </div>
  </div>

  

  <div class="container bs-docs-container">
    <div class="row">
      <!-- Content
      =========================================== -->
      <div class="col-md-9" role="main">
        <section class="bs-docs-section">
  <h1 id="overview" class="page-header">Overview</h1>

  <blockquote>
    A serverside toolkit for writting python backends in <i>minutes</i>!
  </blockquote>

  <h3 id="goal">Goal</h3>
  <p>
    Our goal is to have a library, that we can use to rapidly prototype new ideas,
    essentially create a backend for a new project in a matter of minutes, that
    can be easily expanded on, and because it's built around Django, be
    trusted to be used in production.
  </p>
  <p>
    We want people to focus more on creating new ideas, and less time on
    maintaining and building systems!
  </p>

  <h3 id="why">Why</h3>
  <p>
    Our philosophy was not to introduce another framework for you to learn, that is then
    hard to intergrate with other frameworks and packages, thus <code>serverside</code>
    is more like a bunch of helper functions and classes. We have lots of helpers built
    around Ariadne GraphQL, authentication, django fields, generators, loggers,
    server-side-events, etc.
  </p>
  <p>
    An important note, is that we have built most functionality around python's
    <code>async</code> functionality. This is because it makes this library more
    future proof, and with Django planning a full move to async, it is the right move.
  </p>
  <p>
    We hope that with this project being open-source, we can handle use-cases that we havn't
    thought of. We wrote this library specifically to prototype new ideas <b>really</b> fast,
    but every application is different, there may be situations that we havn't thought of,
    if you feel there is something we should add, or any problems, please start an issue,
    and we can work together to solve it, create a pull request and that make sure
    a new version is published with said features.
  </p>

  <h3 id="installation">Installation</h3>

  This project is on PyPi, and you can install it via:

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pip3 <span class="nb">install </span>serverside</code></pre></figure>

  <h3 id="project-structure">Project Structure</h3>

  <p>
    Everyone's project structure is different, but as we use Django
    for core components, we generally have a structure similar to that
    of Django. We have a folder called <code>apps</code> where each sub-folder
    would contain similar logic, for example <code>users</code>, <code>transaction</code>,
    <code>media</code>.
  </p>
  <p>
    We then have a folder called <code>config</code>, which has a sub-folder called
    <code>settings</code>, which has files <code>base.py</code>, <code>dev.py</code>,
    <code>stage.py</code>, <code>prod.py</code>, etc... which are exactly the same
    as Django's <code>settings.py</code> file, just that we can conveniently choose
    the settings file we wish to run with.
  </p>
  <p>
    All other files in <code>config</code>, are related to things such as
    the graphql schema, routing, middleware, etc...
  </p>
  <p>
    And then in the root directory, we have a simple <code>main.py</code> file,
    that we can use to launch our server. The following diagram summerizes this
  </p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">.</span>
├── apps
│   └── <span class="nb">users</span>
│       ├── migrations
│       │   └── 0001_initial.py
│       ├── models.py
│       └── resolvers.py
├── config
│   ├── middleware.py
│   ├── router.py
│   ├── routes.py
│   ├── schema.graphql
│   ├── schema.py
│   ├── settings
│   │   ├── base.py
│   │   ├── dev.py
│   │   ├── prod.py
│   │   └── stage.py
│   └── urls.py
└── main.py</code></pre></figure>

</section>

<section class="bs-docs-section">
  <h1 id="graplhql" class="page-header">GraphQL</h1>
  <p>
    This sections shows how to use our graphQL helper functions. There are two major frameworks
    for working with graphQL from python, <code>ariadne</code> and <code>graphene</code>.
    Graphene generates the schema from code, while Ariadne requires the schema to be already present.
    We like working with Ariadne because we pay more attention to the design and architecture of
    our service, and then add the nescessary resolvers to return that information. We have
    found that when you have complex services, using multiple databases or adding intermediatry logic, having the ability to
    have fine grain control is essential. We have used graphene in the past, and was quite a challenge when topics
    such as microservice architecture, custom inputs were present.
  </p>
  <p>
    It's important to know that we fully endorse relay style pagination, so our automatic crud operation for listing
    rows automatically formats to use relay style (<code>edges -> node -> data</code>) 
  </p>
  <h2 id="setup">Setup</h2>
  In your settings file, you need to make sure you have the following

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.graphql.ariadne</span> <span class="kn">import</span> <span class="n">QueryType</span><span class="p">,</span> <span class="n">MutationType</span>  <span class="c1"># Same as ariadne.{QueryType, MutationType}
</span><span class="n">QUERY</span> <span class="o">=</span> <span class="n">QueryType</span><span class="p">()</span>
<span class="n">MUTATION</span> <span class="o">=</span> <span class="n">MutationType</span><span class="p">()</span></code></pre></figure>

  Once that is done, you can then setup your normal <code>Ariadne</code>
  graphQL schema. We make use of a graphQL file for our schema. We love schema
  first graphQL because it allows for maximum flexibility in using your own
  custom logic and it can be reviewed by multiple members in your team.

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">ariadne</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">serverside.graphql.ariadne.scalars</span> <span class="kn">import</span> <span class="n">datetime_scalar</span>
<span class="kn">from</span> <span class="nn">serverside.graphql.ariadne.relay</span> <span class="kn">import</span> <span class="n">relay_node</span>

<span class="n">schema</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"schema.graphql"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">ariadne</span><span class="o">.</span><span class="n">make_executable_schema</span><span class="p">(</span>
    <span class="n">schema</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">QUERY</span><span class="p">,</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">MUTATION</span><span class="p">,</span>
        <span class="n">relay_node</span><span class="p">,</span>
        <span class="n">datetime_scalar</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span></code></pre></figure>

  Now you can use this schema as you normally do, read on for how to include our
  custom resolvers to help write endpoints super fast.

  <h2 id="baseresolver">BaseResolver</h2>
    For each django application, for e.g. <code>users</code>, which contains
    <code>models.py</code>, <code>migrations</code>, etc.., we have another file
    called <code>resolvers.py</code>, where we would define a resolver class for
    each model in <code>models.py</code>.

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">typing</span> <span class="k">as</span> <span class="n">ty</span>
<span class="kn">from</span> <span class="nn">serverside.graphql.ariadne</span> <span class="kn">import</span> <span class="n">BaseResolver</span><span class="p">,</span> <span class="n">auto_crud</span>
<span class="kn">from</span> <span class="nn">apps.users.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">UserResolver</span><span class="p">(</span><span class="n">BaseResolver</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">auto_crud</span> <span class="o">=</span> <span class="n">auto_crud</span><span class="p">(</span>
            <span class="n">count</span><span class="o">=</span><span class="s">"userCount"</span><span class="p">,</span> <span class="n">get_one</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">get_many</span><span class="o">=</span><span class="s">"users"</span><span class="p">,</span>
            <span class="n">create</span><span class="o">=</span><span class="s">"createUser"</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="s">"updateUser"</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="s">"deleteUser"</span>
        <span class="p">)</span>
        <span class="n">uid_gen</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">export_resolvers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ty</span><span class="o">.</span><span class="n">List</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">UserResolver</span><span class="p">,</span>
    <span class="p">]</span></code></pre></figure>

    We inherit from our <code>BaseResolver</code> class, and on the <code>Meta</code>,
    define the model we are using, names for our automatic crud operations, and a function for
    generating unique id's (used for the primary key in create operations).

    The <code>auto_crud</code> is the interesting part, here we define the names of the
    graphQL actions for this models crud operations.

Now that we have our resolvers, we can revisit where we define our schema, and update it so it reads:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">ariadne</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">serverside.graphql.ariadne.scalars</span> <span class="kn">import</span> <span class="n">datetime_scalar</span>
<span class="kn">from</span> <span class="nn">serverside.graphql.ariadne.relay</span> <span class="kn">import</span> <span class="n">relay_node</span>
<span class="kn">from</span> <span class="nn">serverside.graphql.ariadne.helpers</span> <span class="kn">import</span> <span class="n">combine_resolvers</span>  <span class="c1"># New
</span><span class="kn">from</span> <span class="nn">apps.users.resolvers</span> <span class="kn">import</span> <span class="n">export_resolvers</span> <span class="k">as</span> <span class="n">er1</span>  <span class="c1"># New
</span>
<span class="n">schema</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"schema.graphql"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">ariadne</span><span class="o">.</span><span class="n">make_executable_schema</span><span class="p">(</span>
    <span class="n">schema</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">QUERY</span><span class="p">,</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">MUTATION</span><span class="p">,</span>
        <span class="n">relay_node</span><span class="p">,</span>
        <span class="n">datetime_scalar</span><span class="p">,</span>
        <span class="o">*</span><span class="n">combine_resolvers</span><span class="p">([</span><span class="n">er1</span><span class="p">])</span>  <span class="c1"># New
</span>    <span class="p">]</span>
<span class="p">)</span></code></pre></figure>

  And that's it, we now have all all crud operations for the <code>User</code> model.
  For examples of how a <code>schema.graphl</code> file might look, see our example in
  the main respositories <code>example</code> directory.

  <h2 id="automatic-filtering">Automatic Filtering</h2>

  When we set <code>get_many="users"</code> in our resolver, we automatically
  provide filtering through the graphql query. We directly use the syntax of 
  Django's ORM to do the filtering. So for example, the following would be our
  graphQL definition of <code>users</code> in our <code>schema.graphql</code> file:

<figure class="highlight"><pre><code class="language-graphql" data-lang="graphql"><span class="err">users(</span><span class="w">
  </span><span class="err">first:</span><span class="w"> </span><span class="err">Int</span><span class="p">,</span><span class="w"> </span><span class="err">after:</span><span class="w"> </span><span class="err">Int</span><span class="p">,</span><span class="w"> </span><span class="err">before:</span><span class="w"> </span><span class="err">Int</span><span class="p">,</span><span class="w"> </span><span class="err">sortBy:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">sortDirection:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w">
  </span><span class="err">name:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">name__startswith:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">name__istartswith:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w">
  </span><span class="err">name__endswith:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">name__iendswith:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">name__contains:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">name__icontains:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w">
  </span><span class="err">username:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">username__startswith:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">username__istartswith:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w">
  </span><span class="err">username__endswith:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">username__iendswith:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">username__contains:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w"> </span><span class="err">username__icontains:</span><span class="w"> </span><span class="err">String</span><span class="p">,</span><span class="w">
</span><span class="err">):</span><span class="w"> </span><span class="err">UserConnection</span><span class="p">!</span></code></pre></figure>

  Now, when you submit your graphQL query, all of these attributes can now be filtered
  as needed, all the logic already taken care for you. For example, the following query
  will get the first 5 users, sorted alphabetically on their username, whos username
  contains the word <i>python</i>, and just return the fields <code>id</code>,
  <code>username</code> and <code>updated</code>. This is where we think the power
  of our <code>serverside</code> library comes in, we want to to build things <i>FAST</i>,
  but also <i>work</i> and are <i>usable</i>. We essentially have all this logic,
  from only writing our models in <code>models.py</code>, and a small <code>UserResolver</code>
  class.

<figure class="highlight"><pre><code class="language-graphql" data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">users</span><span class="p">(</span><span class="n">first</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">sortBy</span><span class="p">:</span><span class="w"> </span><span class="s2">"username"</span><span class="p">,</span><span class="w"> </span><span class="n">sortDirection</span><span class="p">:</span><span class="w"> </span><span class="s2">"asc"</span><span class="p">,</span><span class="w"> </span><span class="n">username__icontains</span><span class="err">="</span><span class="n">python</span><span class="err">"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">edges</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">node</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">id</span><span class="w">
        </span><span class="n">username</span><span class="w">
        </span><span class="n">updated</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w"> 
</span><span class="p">}</span></code></pre></figure>

  <h2 id="customcrud">Custom CRUD</h2>

  Let's say you have custom logic you want to do before creating a user, and then some more
  logic to create the user. Let's say our custom logic, we can alter the <code>BaseResolver</code>
  to read:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">typing</span> <span class="k">as</span> <span class="n">ty</span>
<span class="kn">from</span> <span class="nn">serverside.graphql.ariadne</span> <span class="kn">import</span> <span class="n">BaseResolver</span><span class="p">,</span> <span class="n">auto_crud</span>
<span class="kn">from</span> <span class="nn">apps.users.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">UserResolver</span><span class="p">(</span><span class="n">BaseResolver</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">auto_crud</span> <span class="o">=</span> <span class="n">auto_crud</span><span class="p">(</span>
            <span class="n">count</span><span class="o">=</span><span class="s">"userCount"</span><span class="p">,</span> <span class="n">get_one</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">get_many</span><span class="o">=</span><span class="s">"users"</span><span class="p">,</span>
            <span class="n">update</span><span class="o">=</span><span class="s">"updateUser"</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="s">"deleteUser"</span>  <span class="c1"># Note we didn't pass `create`
</span>        <span class="p">)</span>
        <span class="n">uid_gen</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="o">@</span><span class="n">settings</span><span class="o">.</span><span class="n">MUTATION</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">"createUser"</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">resolve_create</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">ty</span><span class="o">.</span><span class="n">Dict</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">custom_logic</span><span class="p">()</span>
        <span class="n">user_instance</span> <span class="o">=</span> <span class="n">custom_create_user_logic</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"error"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"message"</span><span class="p">:</span> <span class="s">"Create Successfull!"</span><span class="p">,</span> <span class="s">"node"</span><span class="p">:</span> <span class="n">user_instance</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">export_resolvers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ty</span><span class="o">.</span><span class="n">List</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">UserResolver</span><span class="p">,</span>
    <span class="p">]</span></code></pre></figure>

  <h2 id="custom-fields">Custom Fields</h2>
  We may also want that our model has a calculated field, that is not present
  on the model, let's say that we wanted to return "Hi ," before every name, we can
  do this via:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.graphql.ariadne</span> <span class="kn">import</span> <span class="n">ObjectType</span>  <span class="c1"># Same as ariadne.ObjectType
</span>
<span class="k">class</span> <span class="nc">UserResolvers</span><span class="p">(</span><span class="n">BaseResolver</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">ObjectType</span><span class="p">(</span><span class="s">"User"</span><span class="p">)</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="o">@</span><span class="n">user</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">"hiName"</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_hi_name</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s">"Hi, {obj.name}"</span></code></pre></figure>

  <h2 id="database hits">Database Hits</h2>
  
  <p>
    You may be wondering that with so much logic taken care of automatically, how database queries might look.
    For django models we make use of Django's ORM. When django queries the database, it handles data from foreign keys or
    many-to-many relationships by not writing the query as a series of SQL <code>join</code>'s, but has 1 call per table
    (assuming the ORM query has been written correctly), and then joins them in python.
    We have made sure that our ORM queries are fully optimized in all circumstances. This means that we not only have
    the ability to rapidly create models with full CRUD functionality, but also have them highly optimized so they
    work well in production and not wasting resources.
  </p>
  <p>
    With Django planning to fully move to async, this will be even faster!
  </p>


</section>

<section class="bs-docs-section">
  <h1 id="authentication" class="page-header">Authentication</h1>

  This section shows some useful authentication helpers.

  <h2 id="jwt">JWT</h2>

  Inside your settings file, you could add:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.auth</span> <span class="kn">import</span> <span class="n">JWTAuth</span>

<span class="n">JWT_AUTH</span> <span class="o">=</span> <span class="n">JWTAuth</span><span class="p">(</span>
    <span class="n">secret_key</span><span class="o">=</span><span class="s">"secret_key"</span><span class="p">,</span>
    <span class="n">encode_algorithm</span><span class="o">=</span><span class="s">"HS512"</span><span class="p">,</span>
    <span class="n">decode_algorithms</span><span class="o">=</span><span class="p">[</span><span class="s">"HS512"</span><span class="p">]</span>
<span class="p">)</span></code></pre></figure>

  Where you could now encode and decode with:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>

<span class="n">token</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">JWT_AUTH</span><span class="o">.</span><span class="n">encode_jwt</span><span class="p">(</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s">"user_id"</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="nb">id</span><span class="p">},</span>
    <span class="n">expiration</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">authenticated</span><span class="p">,</span> <span class="n">error_message</span><span class="p">,</span> <span class="n">decoded_jwt</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">JWT_AUTH</span><span class="o">.</span><span class="n">authenticate_jwt</span><span class="p">(</span><span class="n">token</span><span class="p">)</span></code></pre></figure>

  <h2 id="passwords">Passwords</h2>

  We also have helpers for generated password hashes and validating them:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.auth</span> <span class="kn">import</span> <span class="n">generate_hashed_password</span><span class="p">,</span> <span class="n">validate_password</span>

<span class="n">hashed_password</span> <span class="o">=</span> <span class="n">generated_hashed_password</span><span class="p">(</span><span class="s">"pass1234"</span><span class="p">)</span>  <span class="c1"># str
</span><span class="n">validated</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>  <span class="c1"># boolean</span></code></pre></figure>

  We use the Argon2 hashing algorithm.

</section>

<!-- <h3 id="social-buttons" data-no-menu>Header 3</h3> -->

<section class="bs-docs-section">
  <h1 id="middleware" class="page-header">Middleware</h1>

  With graphql requests we wanted to add things in the middleware
  that would be accessible in the graphql context, so we added a
  way to <i>middlewarize</i> any function, and then set that result as
  a key in the context

  <h2 id="middlewarize">Middlewarize</h2>

  You can define any function, and then middlewarize. The following example shows
  a function which authorizes a user, and then returns that user instance.
  Functions to be <code>middlewarized</code> need to be <code>async</code>,
  and they also need to accept a <code>request</code> and <code>context</code>
  object:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.middleware</span> <span class="kn">import</span> <span class="n">middlewareize</span>
<span class="kn">from</span> <span class="nn">apps.users.models</span> <span class="kn">import</span> <span class="n">User</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">authorize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>  <span class="c1"># `authenticate` raises an exception if not valid
</span>    <span class="n">authentication_token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">authentication_token</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">"No token in request!"</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">authentication_token</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span>

<span class="n">authorize_middleware</span> <span class="o">=</span> <span class="n">middlewareize</span><span class="p">(</span><span class="s">"user"</span><span class="p">,</span> <span class="n">authorize</span><span class="p">)</span></code></pre></figure>

  Now we can use that middleware via:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.middleware</span> <span class="kn">import</span> <span class="n">run_middleware</span>
<span class="kn">from</span> <span class="nn">.middleware</span> <span class="kn">import</span> <span class="n">authorize_middleware</span>

<span class="o">@</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Context</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"context"</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_graphql</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_middleware</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">authorize_middleware</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">Context</span> 
    <span class="p">)</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">success</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">graphql</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">json_data</span><span class="p">,</span> <span class="n">context_value</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></code></pre></figure>

  <p>
    And now, we inside our graphql context, we access the key <code>users</code>,
    and have all the information we need, calculated from the middleware.
  </p>
  <p>
    The idea of chaining middleware together like this was taken from Express.js,
    a popular Javascript backend library.
  </p>


</section>


<section class="bs-docs-section">
  <h1 id="django-fields" class="page-header">Django Fields</h1>

  This section shows our custom django fields

  <h2 id="s3field">S3Field</h2>

  Our <code>S3Field</code> was introduced for conveniently keeping
  information about object storage, particularly amazons s3. It can
  store three attributes:

  <ul>
    <li>location </li>
    <li>bucket</li>
    <li>key</li>
  </ul>

  <p>
    The 'location' attribute was introduced because of certain use-cases of having
    different object storage platforms in the same database, so may be useful for
    other people too.
  </p>
  <p>
    You can use it as follows:
  </p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.django.fields</span> <span class="kn">import</span> <span class="n">S3Field</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">avatar</span> <span class="o">=</span> <span class="n">S3Field</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># This is saved in the database the same as `CharField`</span></code></pre></figure>

  You can now save to it via:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.django.fields</span> <span class="kn">import</span> <span class="n">S3FieldObject</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">some_get_user_logic</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">avatar</span> <span class="o">=</span> <span class="n">S3FieldObject</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s">"location"</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="s">"bucket"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">"key"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"bucket: "</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">avatar</span><span class="o">.</span><span class="n">bucket</span><span class="p">)</span></code></pre></figure>

</section>


<section class="bs-docs-section">
  <h1 id="generators" class="page-header">Generators</h1>

  This section has some useful generator functions

  <h2 id="s3field">Identicon</h2>

  You can produce a high quality identicon png image, similar to
  that on github via:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.generators</span> <span class="kn">import</span> <span class="n">Identicon</span>

<span class="n">png_bytes</span> <span class="o">=</span> <span class="n">Identicon</span><span class="p">(</span><span class="s">"any_string"</span><span class="p">)</span><span class="o">.</span><span class="n">identicon</span></code></pre></figure>

</section>

<section class="bs-docs-section">
  <h1 id="logging" class="page-header">Logging</h1>

  Logging is important in development, usage of print statements
  in almost all scenarios is a bad idea, as depending on what
  stage the server is in, we can set a logging level to choose
  which level of logs we want to be output.

  <h2 id="color-logger">Color Logger</h2>

  We provide a quick way
  to set up a color logger to easily see any problems that exist:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">serverside.logging</span> <span class="kn">import</span> <span class="n">get_logger</span>
<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"MAINSERVICE"</span><span class="p">)</span></code></pre></figure>

  And then you could use such as:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="n">settings</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Hello World"</span><span class="p">)</span></code></pre></figure>

  You can also override the colors, the defaults in our implementation are:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">debug_primary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"cyan"</span><span class="p">,</span>
    <span class="n">debug_secondary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"bold_white"</span><span class="p">,</span>
    <span class="n">info_primary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"bold_purple"</span><span class="p">,</span>
    <span class="n">info_secondary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"white"</span><span class="p">,</span>
    <span class="n">warning_primary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"bold_black,bg_yellow"</span><span class="p">,</span>
    <span class="n">warning_secondary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"bold_yellow"</span><span class="p">,</span>
    <span class="n">error_primary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"bold_whote,bg_red"</span><span class="p">,</span>
    <span class="n">error_secondary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"bold_red"</span><span class="p">,</span>
    <span class="n">critical_primary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"bold_white,bg_red"</span><span class="p">,</span>
    <span class="n">critical_secondary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"bold_red"</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span></code></pre></figure>
</section>











      </div>

      <!-- Page navigation
      =========================================== -->
      <div class="col-md-3" role="complementary">
        <div class="bs-docs-sidebar hidden-print">
          <ul class="nav bs-docs-sidenav">
          </ul>
          <a class="back-to-top" href="#top">
            <i class="glyphicon glyphicon-chevron-up"></i> Back to top
          </a>
        </div>
      </div>
    </div>
  </div>


  <!-- Footer
  =========================================== -->
  <footer class="bs-docs-footer" role="contentinfo">
    <div class="container">
      <div class="bs-docs-social">
        <ul class="bs-docs-social-buttons">
        
          <li>
            <iframe class="github-btn" src="https://ghbtns.com/github-btn.html?user=asciialex&amp;repo=python-serverside&amp;type=watch&amp;count=true" width="90" height="20" title="Star on GitHub"></iframe>
          </li>
          <li>
            <iframe class="github-btn" src="https://ghbtns.com/github-btn.html?user=asciialex&amp;repo=python-serverside&amp;type=fork&amp;count=true" width="90" height="20" title="Fork on GitHub"></iframe>
          </li>
        
        </ul>
      </div>

      <ul class="bs-docs-footer-links muted">
        <li>Currently v1.0.2</li>
      
        <li>&middot;</li>
        <li><a href="https://github.com/asciialex/python-serverside">GitHub</a></li>
      
      </ul>
    </div>
  </footer>


  <!-- Async scripts
  =========================================== -->
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/trianglify/1.0.1/trianglify.min.js"></script>
  <script>jekyllDoc.trianglify('#080331', '#673051', 'Python Serverside');</script>
  

</body>
</html>
